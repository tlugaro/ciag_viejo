<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">

        <title>CIAg - Mapas Presente</title>
        <!-- Favicons -->
        <link href="static/img/icono.ico" rel="icon">
        <link href="static/img/icono.png"  rel="apple-touch-icon" alt="Ciag">
        <!-- Bootstrap CSS CDN -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
        <!-- Our Custom CSS -->
        <link rel="stylesheet" href="static/css/style3.css">
        <!-- Scrollbar Custom CSS -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">
        <!-- Popper.JS -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>

        <!-- Font Awesome JS -->
        <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ" crossorigin="anonymous"></script>
        <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY" crossorigin="anonymous"></script>
        <!-- LEAFLET -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin="" />
        <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet-src.js" integrity="sha512-GBlVVqOnLycKN+z49gDABUY6RxEQjOw/GHFbpboxpTxAPJQ78C6pAjT08S/1fT9pWOy9PeyDqipC7cBwrfX2cA==" crossorigin=""></script>
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.6.1/font/bootstrap-icons.css">

        <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-locatecontrol/0.66.2/L.Control.Locate.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-locatecontrol/0.66.2/L.Control.Locate.min.css"/>

        <script type="text/javascript" src="static/capas/provincias.js"></script>


</head>
    <style>
        .foliumtooltip {
            background-color: grey; color: white;
        }
        .foliumtooltip table{
            margin: auto;
        }
        .foliumtooltip tr{
            text-align: left;
        }
        .foliumtooltip th{
            padding: 2px; padding-right: 8px;
        }
    </style>


    <style>
        .foliumtooltip {
            background-color: grey; color: white;
        }
        .foliumtooltip table{
            margin: auto;
        }
        .foliumtooltip tr{
            text-align: left;
        }
        .foliumtooltip th{
            padding: 2px; padding-right: 8px;
        }
        .legend {
            line-height: 20px;
            color: #232323;
            border-radius: 5px;
            background-color: rgba(222,222,222,0.6);

        }
        .legend i {
            width: 20px;
            height: 18px;
            float: left;
            margin-right: 8px;
            margin-bottom: 2px;
            opacity: 0.7;
        }
    </style>
<body>

<div class="wrapper">
    <!-- Sidebar  -->
    <nav id="sidebar">
        <div id="dismiss" >
            <i class="fas fa-arrow-left"></i>
        </div>

        <div class="sidebar-header">
            <h2>Control de capas</h2>
        </div>

        <ul class="list-unstyled components">
            <form id="capas" name= "formulario1">
                <div class="form-group" >
                    <label for="var">Variable  <span class="tool" data-tip="Las variables disponibles en nuestra base de datos son..."
                                                     tabindex="1"><i class="bi bi-info-circle"></i></span></label>


                    <select class="form-control" id="var" name="cosa" onchange="cambia()" required aria-required="true">
                        <option value="" disabled selected>Elija una variable</option>
                        <option value="2">Precipitación</option>
                        <option value="1">Evapotranspiración Potencial (Penman Fao)</option>
                        <option value="1">Temperatura Media</option>
                        <option value="1">Temperatura Máxima</option>
                        <option value="1">Temperatura Mínima</option>
                        <option value="1">Radiación</option>
                        <option value="1">Humedad</option>
                        <option value="1">Déficit de Presión de Vapor</option>
                        <option value="1">Tensión de Vapor</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="bd">Fuente de Datos</label>
                    <select class="form-control" id="bd" name="opt"  required aria-required="true">
                        <option value="-" disabled selected>Elija una base de datos</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="tp">Período</label>
                    <select class="form-control" id="tp" name="options" required aria-required="true">
                        <option value="-" disabled selected>Elija un período de tiempo</option>
                    </select>
                </div>

                <button class="btn btn-primary" id="newLayer"  > Ver Capa</button>
                <button class="btn btn-primary" id="downloaderLayer"  >Descargar Capa</button>

                <button class="btn btn-primary" id="volveralinicio"  >Volver al Inicio</button>
            </form>

            </form>


        </ul>

        <ul class="list-unstyled CTAs">

            <a href="index"><img src="static/img/icon.png", class="img-fluid"></a>
        </ul>

    </nav>

    <!-- Page Content  -->
    <div id="content">

        <nav class="navbar">
            <div class="container-fluid">

                <button type="button" id="sidebarCollapse" class="btn btn-info">
                    <i class="bi-layers-half"></i>
                    <span>Control de Capas</span>
                </button>
                <a href="index"><button id="volver" class="btn btn-info">
                    <span>Volver al inicio</span>
                </button></a>
            </div>

        </nav>
    </div>
</div>
<a href="index"><img id="IMAGEN_FLOT" alt="CIAg"
                     src="static/img/icon.png"
                     style="z-index: 999999">
</img></a>
<!-- Bootstrap JS -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
<!-- jQuery Custom Scroller CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="https://unpkg.com/proj4"></script>
<script src="https://unpkg.com/georaster"></script>
<script src="https://unpkg.com/georaster-layer-for-leaflet/georaster-layer-for-leaflet.browserify.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.1.0/chroma.min.js"></script>

<script type="text/javascript" charset="UTF-8" >
    $('#sidebar').addClass('active');
    $(document).ready(function () {
        $("#sidebar").mCustomScrollbar({
            theme: "minimal"
        });

        $('#dismiss, .overlay').on('click', function () {
            $('#sidebar').removeClass('active');
            $('.overlay').removeClass('active');
        });

        $('#sidebarCollapse').on('click', function () {
            $('#sidebar').addClass('active');
            $('.overlay').addClass('active');
            $('.collapse.in').toggleClass('in');
            $('a[aria-expanded=true]').attr('aria-expanded', 'false');
        });
    });



    var map = L.map('content', { zoomControl:false, minZoom: 4, zoomSnap: 0.25 }).setView([-38.86, -64.33], 4.5);

    var all = L.layerGroup().addTo(map)



    L.tileLayer("https://wms.ign.gob.ar/geoserver/gwc/service/tms/1.0.0/capabaseargenmap@EPSG%3A3857@png/{z}/{x}/{-y}.png",
        {"attribution": "\u003ca href=\"http://www.ciag.com.ar\" target=\"_blank\"\u003eCIAg\u003c/a\u003e | \u003ca href=\"http://www.ign.gob.ar\" target=\"_blank\"\u003eInstituto Geogr\u00e1fico Nacional\u003c/a\u003e + \u003ca href=\"http://www.osm.org/copyright\" target=\"_blank\"\u003eOpenStreetMap\u003c/a\u003e", "detectRetina": false, "maxNativeZoom": 18, "maxZoom": 18, "z-index":900, "minZoom": 4, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
    ).addTo(map);

    var url_to_geotiff_file =("./smnlinear.tif")

    fetch(url_to_geotiff_file)
        .then(response => response.arrayBuffer())
        .then(arrayBuffer => {
            parseGeoraster(arrayBuffer).then(georaster => {
                const min = georaster.mins[0];
                const max = georaster.maxs[0];
                const range = georaster.ranges[0];

                // available color scales can be found by running console.log(chroma.brewer);

                var scale = chroma.scale(['#B2381C','#FCA029','#F4D629','#F7FF82','#D5FA79','#A3F32F','#43CD2A','#0A8838','#135943','#07332C','#2B2387']);

                var layer = new GeoRasterLayer({
                    georaster: georaster,
                    opacity: 0.8,
                    pixelValuesToColorFn: function(pixelValues) {
                        var pixelValue = pixelValues[0]; // there's just one band in this raster



                        if ((  isNaN(pixelValue))) return null;
                        // scale to 0 - 1 used by chroma
                        var scaledPixelValue = (pixelValue - min) / range;

                        var color = scale(scaledPixelValue).hex();

                        return color;
                    },

                    resolution: 256
                });
                console.log("layer:", layer);
                layer.addTo(map);

                map.fitBounds(layer.getBounds());


            });
        });
</script>


</body>
</html>