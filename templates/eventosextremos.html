<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>CIAg - Probabilidades</title>
    <!-- Favicons -->
  <link href="static/img/icono.ico" rel="icon">
  <link href="static/img/icono.png"  rel="apple-touch-icon" alt="Ciag">
    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <!-- Our Custom CSS -->
    <link rel="stylesheet" href="static/css/style_series.css">
    <!-- Scrollbar Custom CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">
<!-- Popper.JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>

    <!-- Font Awesome JS -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ" crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY" crossorigin="anonymous"></script>
    <!-- LEAFLET -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin="" />
<script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet-src.js" integrity="sha512-GBlVVqOnLycKN+z49gDABUY6RxEQjOw/GHFbpboxpTxAPJQ78C6pAjT08S/1fT9pWOy9PeyDqipC7cBwrfX2cA==" crossorigin=""></script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.6.1/font/bootstrap-icons.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-locatecontrol/0.66.2/L.Control.Locate.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-locatecontrol/0.66.2/L.Control.Locate.min.css"/>
    <!--[if lt IE 9]>
    <script src="https://code.highcharts.com/modules/oldie-polyfills.js"></script>
    <![endif]-->
    <script src="https://polyfill.io/v3/polyfill.js?features=default%2Ces2015%2CElement.prototype.dataset%2CXMLHttpRequest"></script>


    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>

    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <link rel="stylesheet" href="../static/css/style_series.css">
    <script src="../static/capas/estaciones_heladasygc.js"></script>


</head>
<style>
                        .foliumtooltip {
                            background-color: grey; color: white;
                        }
                       .foliumtooltip table{
                            margin: auto;
                        }
                        .foliumtooltip tr{
                            text-align: left;
                        }
                        .foliumtooltip th{
                            padding: 2px; padding-right: 8px;
                        }

                    </style>


                    <style>
                        .foliumtooltip {
                            background-color: grey; color: white;
                        }
                       .foliumtooltip table{
                            margin: auto;
                        }
                        .foliumtooltip tr{
                            text-align: left;
                        }
                        .foliumtooltip th{
                            padding: 2px; padding-right: 8px;
                        }
                        .legend {
                            line-height: 20px;
                            color: #232323;
                            border-radius: 5px;
                            background-color: rgba(222,222,222,0.6);

                        }
                        .legend i {
                            width: 20px;
                            height: 18px;
                            float: left;
                            margin-right: 8px;
			    margin-bottom: 2px;
                            opacity: 0.7;
                        }
                        .loading {
                            position: fixed;
                            left: -400%;
                            top: 40%;
                            width: 20%;
                            height: 20%;
                            z-index: 9999;
                            background: url("{{ url_for('static',filename='/img/pageLoader.gif')}}") 50% 50% no-repeat ;
                            opacity: 1;
                        }
                        .loading.active {
                            position: fixed;
                            left: 40%;
                            top: 40%;
                            width: 20%;
                            height: 20%;
                            z-index: 9999;
                            background: url("{{ url_for('static',filename='/img/pageLoader.gif')}}") 50% 50% no-repeat ;
                            opacity: 1;
                        }

                    </style>
<body>

    <div class="wrapper">
        <!-- Sidebar  -->
        <nav id="sidebar">


            <div class="sidebar-header">
                <h2>Gráficos de probabilidad (SMN)</h2>
            </div>


            <ul class="list-unstyled components">
                    <form id="capas" name= "formulario1" >

                        <div class="form-group" >
                    <label for="variable" class="subtitle-for">Variable  </label>
        <select class="form-control" id="variable" name="variable" aria-label=".form-select-sm example" >
            <option  value="">Elija una variable</option>

            <option value="heladastardias">Heladas tardías</option>
            <option value="heladastempranas">Heladas tempranas</option>
            <option value="gcantes">Golpes de calor antes de...</option>
            <option value="gcdespues">Golpes de calor despues de...</option>

        </select>
      </div>

                <div style="padding-top: 40px"><figure id="highcharts-figure" class="highcharts-figure">
        <div id="container"></div>
    </figure></div>



      <button class="cta-btn" id="volveralinicio"  ><a href="/index">Volver al Inicio</a></button>
                    </form>




</ul>

            <ul class="list-unstyled CTAs">

                <a href="/index"><img src="static/img/icon.png", class="img-fluid"></a>
            </ul>

        </nav>

    </div>
    </div>
     <!-- Page Content  -->
        <div id="content">
            <div>
                <tbody >
                <section id="graf">
                    <script type="text/javascript">

                        var colors = Highcharts.getOptions().colors;

                        var chart= Highcharts.chart('container', {
                            chart: {style: {
            fontFamily: 'Arial'
        },
                                type: 'spline'
                            },
				
                            legend: {
                                symbolWidth: 40
                            },
                            title: {
                                text:"Hacé click sobre una estación del mapa"
                            },
                            lang: {

                                viewFullscreen:"Pantalla completa",
                                printChart:"Imprimir Gráfico",
                                downloadPNG: 'Descargar PNG',
                            },

                            exporting: {
                                buttons: {
                                    contextButton: {
                                        menuItems: ["viewFullscreen","printChart","downloadPNG"]
                                    }
                                }
                            },
                            subtitle: {
                                text: 'Período de referencia 1991 - 2020'
                                },
                            yAxis: {
                                min: 0,
                                max:1,
                                title: {
                                    text: 'Variable'
                                },
                                accessibility: {
                                    description: 'Agua útil (%)'

                                }

                            },

                            xAxis: {
                                title: {
                                    text: 'Días'
                                },
                                 tickInterval: 30,
                                accessibility: {
                                    description: ''
                                },
                            },
                            tooltip: {
                                valueSuffix: ''
                            },
                            plotOptions: {
        series: {
            lineWidth: 3
        }
    },
                            series:[
                                        {
                                            type: 'spline',
                                            name: 'Leve',
                                            data: [],
                                            dashStyle: 'solid',
                                            color: "#9bbb59",
                                            zIndex: 1,
                                            marker:{enabled:false}
                                        },{
                                            type: 'spline',
                                            name: 'Moderada',
                                            data: [],
                                            dashStyle: 'solid',
                                            color: "#4f81bd",
                                            zIndex: 1,
                                    marker:{enabled:false},
                                        },
                                    {
                                            type: 'spline',
                                            name: 'Severa',
                                            data: [],
                                            dashStyle: 'solid',
                                            color: "#F15025",
                                            zIndex: 1,
                                        marker:{enabled:false},
                                        },
                                    {
                                            type: 'spline',
                                            name: 'Extrema',
                                            data:[] ,
                                            dashStyle: 'solid',
                                            color: "#8064a2",
                                            zIndex: 1,
                                        marker:{enabled:false},
                                        },],

                            responsive: {
                                rules: [{
                                    condition: {
                                        maxWidth: 50
                                    },
                                    chartOptions: {
                                        chart: {
                                            spacingLeft: 3,
                                            spacingRight: 3
                                        },
                                        legend: {
                                            itemWidth: 150
                                        },
                                        xAxis: {
                                            categories: ["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],
                                            title: 'Meses'
                                        },
                                        yAxis: {
                                            min: 0,
                                            visible: true,
                                            title: 'variable'


                                        }
                                    }
                                }]
                            }
                        });
                    </script>
                </section>
                </tbody>
            </div>
            </div>
    <div class="loading"></div>
    <a href="/index"><img id="IMAGEN_FLOT" alt="CIAg"
                 src="static/img/icon.png"
                 style="z-index: 999999">
    </img></a>

    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    <!-- jQuery Custom Scroller CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.concat.min.js"></script>
    <!-- script tomymaps -->
    <script type="text/javascript" src="{{ url_for('static',filename='/capas/provincias.js')}}"></script>
    <script type="text/javascript" src="{{ url_for('static',filename='/capas/estaciones_heladasygc.js')}}"></script>

    <script src="{{ url_for('static',filename='/js/main.js')}}"></script>

    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>

    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
</body>
<script type="text/javascript">
    var est= new L.geoJson( est, {
                style: styleprov(),
                onEachFeature: onEachFeature
                }).addTo(map)
    est.bindTooltip(
    function (layer) {
        let div = L.DomUtil.create('div');
        let handleObject = feature => typeof (feature) == 'object' ? JSON.stringify(feature) : feature;
        let fields = ["nombre"];
        let table = '<table>' +
            String(
                fields.map(
                    (v, i) =>
                        `<tr>
            <td>${handleObject(layer.feature.properties[v])}</td>

        </tr>`).join(''))
            + '</table>';
        div.innerHTML = table;

        return div
    }
    , {"className": "foliumtooltip", "sticky": true});

var codest =0
var name= "Elija una estación"


            function onEachFeature(feature, est) {
                est.on('click', function (e) {
                    $('.loading').addClass('active');

        var elemento2 = document.getElementById("variable").value
        if (elemento2 == "") {
            $('.loading').removeClass('active');
            alert("Elija una variable!")
            return false
        }
                    var name = (feature.properties.nombre);
                    var codest=(feature.properties.codest);
                    localStorage.setItem("name", (feature.properties.nombre));

                    localStorage.setItem("codest", (feature.properties.codest));
                varname = document.formulario1.variable[document.formulario1.variable.selectedIndex].text;
                    variable = document.formulario1.variable[document.formulario1.variable.selectedIndex].value;


                    $.ajax({
                    url:"/probabilidad",
                    type:"POST",
                    contentType: "application/json", data: JSON.stringify({codest:codest, nombre:name, variable:variable}), success: function(data) {
                        $('.loading').removeClass('active');
                            var fechas= data.fechas
                           var leve =data.leve
                            var moderada =data.moderada
                            var severa =data.severa
                            var extrema =data.extrema
                            var unidad= data.unidad
                            var nombre = data.nombre
                            var unidad= data.unidad
                            var nombre = data.nombre
                            if (variable!="pp") {
                                chart.update({
                                    chart: {
                                        type: 'spline'
                                    },
                                    title: {
                                        text: "Probabilidad  de " + varname + " en " + nombre
                                    },
                                    xAxis:{
                                        categories: fechas,
                                         type: 'datetime',
                                    },
                                    yAxis: {
                                        min: 0,
                                        title: {
                                            text: "Probabilidad de "+ varname + " (" + unidad + ")"
                                        },
                                        accessibility: {
                                            description: unidad

                                        }
                                    },
                                    tooltip: {
                                        valueSuffix: unidad
                                    },
                                     series:[
                                        {
                                            type: 'spline',
                                            name: 'Leve',
                                            data: leve,
                                            dashStyle: 'solid',
                                            color: "#9bbb59",
                                            zIndex: 1,
                                        },{
                                            type: 'spline',
                                            name: 'Moderada',
                                            data: moderada,
                                            dashStyle: 'solid',
                                            color: "#4f81bd",
                                            zIndex: 1,
                                        },
                                    {
                                            type: 'spline',
                                            name: 'Severa',
                                            data: severa,
                                            dashStyle: 'solid',
                                            color: "#c0504d",
                                            zIndex: 1,
                                        },
                                    {
                                            type: 'spline',
                                            name: 'Extrema',
                                            data: extrema,
                                            dashStyle: 'solid',
                                            color: "#8064a2",
                                            zIndex: 1,
                                        },]

                                });
                            }

                        }});
                });

        // do something with the response if needed.
        // If you want the table to be built only after the backend handles the request and replies, call buildTable() here.
             document.getElementById("variable").onchange = function(){
                    variable = document.formulario1.variable[document.formulario1.variable.selectedIndex].value;
                     varname = document.formulario1.variable[document.formulario1.variable.selectedIndex].text;
                    name = localStorage.getItem("name");

                    codest=localStorage.getItem("codest");
                    $.ajax({
                    url:"/probabilidad",
                    type:"POST",
                    contentType: "application/json", data: JSON.stringify({codest:codest, nombre:name,  variable:variable}), success: function(data) {
                            var fechas= data.fechas
                            var leve =data.leve
                            var moderada =data.moderada
                            var severa =data.severa
                            var extrema =data.extrema
                            var unidad= data.unidad
                            var nombre = data.nombre
                            if (variable!="pp") {
                                 chart.update({
                                    chart: {
                                        type: 'spline'
                                    },
                                    title: {
                                        text: "Probabilidad  de " + varname + " en " + nombre
                                    },
                                    xAxis:{
                                        categories: fechas,
                                         type: 'datetime',
                                    },
                                    yAxis: {
                                        min: 0,
                                        title: {
                                            text: "Probabilidad de "+ varname + " (" + unidad + ")"
                                        },
                                        accessibility: {
                                            description: unidad

                                        }
                                    },
                                    tooltip: {
                                        valueSuffix: unidad
                                    },
                                     series:[
                                        {
                                            type: 'spline',
                                            name: 'Leve',
                                            data: leve,
                                            dashStyle: 'solid',
                                            color: "#9bbb59",
                                            zIndex: 1,
                                        },{
                                            type: 'spline',
                                            name: 'Moderada',
                                            data: moderada,
                                            dashStyle: 'solid',
                                            color: "#4f81bd",
                                            zIndex: 1,
                                        },
                                    {
                                            type: 'spline',
                                            name: 'Severa',
                                            data: severa,
                                            dashStyle: 'solid',
                                            color: "#c0504d",
                                            zIndex: 1,
                                        },
                                    {
                                            type: 'spline',
                                            name: 'Extrema',
                                            data: extrema,
                                            dashStyle: 'solid',
                                            color: "#8064a2",
                                            zIndex: 1,
                                        },]
                                });
                            }

                        }});

 };

                }

</script>


</html>
