<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Cultivos</title>
    <!-- Favicons -->
    <link rel="stylesheet" href="static/css/stlye_presente.css">
    <!-- LEAFLET -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet-src.js" integrity="sha512-GBlVVqOnLycKN+z49gDABUY6RxEQjOw/GHFbpboxpTxAPJQ78C6pAjT08S/1fT9pWOy9PeyDqipC7cBwrfX2cA==" crossorigin=""></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.6.1/font/bootstrap-icons.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-locatecontrol/0.66.2/L.Control.Locate.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-locatecontrol/0.66.2/L.Control.Locate.min.css"/>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.1.0/chroma.min.js"></script>
    <!-- Bootstrap JS -->
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    <!-- jQuery Custom Scroller CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.concat.min.js"></script>
    <script src="https://unpkg.com/proj4"></script>
    <script src="https://unpkg.com/georaster"></script>
    <script src="https://unpkg.com/georaster-layer-for-leaflet/georaster-layer-for-leaflet.browserify.min.js"></script>
</head>
<style>
    .foliumtooltip {
        background-color: grey; color: white;
    }
    .foliumtooltip table{
        margin: auto;
    }
    .foliumtooltip tr{
        text-align: left;
    }
    .foliumtooltip th{
        padding: 2px; padding-right: 8px;
    }
</style>


<style>
    .foliumtooltip {
        background-color: grey; color: white;
    }
    .foliumtooltip table{
        margin: auto;
    }
    .foliumtooltip tr{
        text-align: left;
    }
    .foliumtooltip th{
        padding: 2px; padding-right: 8px;
    }
    .legend {
        line-height: 20px;
        color: #232323;
        border-radius: 5px;
        background-color: rgba(222,222,222,0.6);

    }
    .legend i {
        width: 20px;
        height: 18px;
        float: left;
        margin-right: 8px;
        margin-bottom: 2px;
        opacity: 0.7;
    }
</style>


<body>
<div id="content">

</div>
<script src="https://unpkg.com/esri-leaflet@3.0.8/dist/esri-leaflet.js"
        integrity="sha512-E0DKVahIg0p1UHR2Kf9NX7x7TUewJb30mxkxEm2qOYTVJObgsAGpEol9F6iK6oefCbkJiA4/i6fnTHzM6H1kEA=="
        crossorigin=""></script>
<script type="text/javascript">
    function onEachFeature(feature, layer) {
        layer.on({});
    }

    var map = L.map('content', { zoomControl:false, minZoom: 4, zoomSnap: 0.25 }).setView([-38.86, -64.33], 4.5);
    new L.Control.Zoom({ position: 'topright' }).addTo(map);

    var esri= L.esri.basemapLayer('Imagery').addTo(map);

    var locate_control_e5f44ad5fae447d4ab47540d30978b01 = L.control.locate(
        {position:"topright"}
    ).addTo(map);
    var all = L.layerGroup().addTo(map)
    var layerGroup = L.layerGroup();
    var legend = L.control({position: 'bottomright'});
    var ign= L.tileLayer("https://wms.ign.gob.ar/geoserver/gwc/service/tms/1.0.0/capabaseargenmap@EPSG%3A3857@png/{z}/{x}/{-y}.png",
        {"attribution": " \u003ca href=\"http://www.ign.gob.ar\" target=\"_blank\"\u003eInstituto Geogr\u00e1fico Nacional\u003c/a\u003e + \u003ca href=\"http://www.osm.org/copyright\" target=\"_blank\"\u003eOpenStreetMap\u003c/a\u003e", "detectRetina": false, "maxNativeZoom": 18, "maxZoom": 18, "z-index":900, "minZoom": 4, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
    );
    var overlayMaps = {
        "Junin": layerGroup


    };
    var baseMaps = {
        "IGN": ign,
        "Satelite":esri,
    };
    var control_capas=    L.control.layers(baseMaps, overlayMaps,{
        position: 'topright', // 'topleft', 'bottomleft', 'bottomright'
        collapsed: false // true
    }).addTo(map);
    var url_to_geotiff_file = ("juninbyte.tif")

    fetch(url_to_geotiff_file)
        .then(response => response.arrayBuffer())
        .then(arrayBuffer => {
            parseGeoraster(arrayBuffer).then(georaster => {
                const min = georaster.mins[0];
                const max = georaster.maxs[0];
                const range = georaster.ranges[0];

                var scale = chroma.scale(['#499445', '#eaea59', '#fea458', '#b33771', '#55e6c1', '#3b3b98', '#fd7272', '#82589f', '#d6a2e8', '#f97f51', '#eab543', '#1b9cfc', '#58b19f', '#6d214f', '#182c61', '#9aecdb','#bdc581','#f8efba', '#fc427b','#cad3c8']);

                var junin = new GeoRasterLayer({
                    georaster: georaster,
                    opacity: 0.7,
                    pixelValuesToColorFn: function (pixelValues) {
                        var pixelValue = pixelValues[0]; // there's just one band in this raster


                        if ((isNaN(pixelValue))) return null;
                        if (pixelValue<1) return null;
                        // scale to 0 - 1 used by chroma
                        // var scaledPixelValue = (pixelValue - min) / range;
                        var scaledPixelValue = (pixelValue - 1) / 20;

                        var color = scale(scaledPixelValue).hex();

                        return color;
                    },

                    resolution: 256
                });

                junin.addTo(layerGroup);
                map.addLayer(layerGroup);
                junin.bringToFront();

                function getColor(d) {
                    return d == "Soja" ? '#499445' :
                        d == "Maíz" ? '#eaea59' :
                            d == "Girasol" ? '#fea458' :
                                d == "Sorgo" ? '#b33771' :
                                    d == "Maní" ? '#55e6c1' :
                                        d == "Algodón" ? '#3b3b98' :
                                            d == "Arroz" ? '#fd7272' :
                                                d == "Poroto" ? '#82589f' :
                                                    d == "Caña de azúcar" ? '#d6a2e8' :
                                                        d == "Cereales de invierno" ? '#f97f51' :
                                                            d == "Legumbres de invierno" ? '#eab543' :
                                                                d == "Colza" ? '#1b9cfc' :
                                                                    d == "Lino" ? '#58b19f' :
                                                                        d == "Tabaco" ? '#6d214f' :
                                                                            d == "Cultivos de cobertura" ? '#182c61' :
                                                                                d == "Otros cultivos" ? '#9aecdb' :
                                                                                    d == "Recursos forrajeros" ? '#bdc581' :
                                                                                        d == "Barbechos y rastrojos" ? '#f8efba' :
                                                                                            d == "Frutales" ? '#fc427b' :
                                                                                                d == "No agrícolas" ? '#cad3c8':
                             '#8c240c';

                }
                legend.onAdd = function (map) {

                    var div = L.DomUtil.create('div', 'info legend'),
                        grades = ["Soja","Maíz","Girasol","Sorgo","Maní","Algodón","Arroz","Poroto","Caña de azúcar","Cereales de invierno","Legumbres de invierno","Colza","Lino","Tabaco","Cultivos de cobertura","Otros cultivos","Recursos forrajeros","Barbechos y rastrojos","Frutales","No agrícolas"],
                        labels = ['<strong></strong>']
                    title = ["Cultivos"];

                    // loop through our density intervals and generate a label with a colored square for each interval
                    for (var i = 0; i < grades.length; i++) {
                        div.innerHTML +=
                            '<i style="background:' + getColor(grades[i]) + '"></i> ' +
                            grades[i] + (grades[i + 1] ?  '<br>' : ' ');
                    }

                    return div;
                };

                legend.addTo(map);
            })
        });
</script>
</body>
</html>
